pipeline {
    agent any
    tools { 
        maven 'LocalMaven' 
        jdk 'LocalJDK' 
    }  
    stages {
        stage ('Build vehicle-status-service') {
            steps {
         		
                 sh  'mvn clean install checkstyle:checkstyle'
            }

            post{
                success{
                    echo 'Now Archiving build artifact jar file....'

                    archiveArtifacts artifacts : '**/*.jar'
                }
            }
        }
        
        stage('Build Docker image') {
	       steps {
	  			echo 'Building the Image ....'
	        	def customImage = docker.build("vehicle-status-service:v3")
	        	echo 'Building the Image success....'
	        } 
	        post{
                success{
                	customImage.inside {
	        			sh 'echo "Tests passed"'
	        			
    	 			}
    	 			
                }
            }  	
    	}

	    stage('Test image') {
	    	steps {
		    
	            echo 'Pushing the Image ....'
	            customImage.push()
	            echo 'Pushing success....'
	             
	    	}
	    } 		
    }
}